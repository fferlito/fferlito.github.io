<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Federico  Ferlito | 3D Style transfer</title>
<meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.xyz/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî•</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/projects/15_project/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

  <script src="/assets/js/theme.js"></script>
  <!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Federico</span>   Ferlito
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">

          <!-- Other pages -->
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/">
                about
                
              </a>
          </li>
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">3D Style transfer</h1>
    <p class="post-description">Creating marvelous textures with neural networks</p>
  </header>

  <article>
    <div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/style.jpeg" alt="" title="example image" />
    </div>
</div>
<div class="caption">

</div>

<p>Neural networks have been very popular in the last years, especially in the field of computer vision, where they achieved remarkable results in tasks like image classification. In the last years, a new wave of artist is pushing their bundaries further, using techniques like <a href="https://ai.googleblog.com/2015/06/inceptionism-going-deeper-into-neural.html" target="blank">DeepDream</a>, <a href="https://arxiv.org/pdf/1508.06576.pdf" target="blank">style transfer</a> and <a href="https://distill.pub/2017/feature-visualization/" target="blank">feature visualization</a> to create artistic images and abstract visualizations.</p>

<p>All these technologies are based on the same intuition. Convolutional neural networks are formed stacking layers of <em>artifical neurons</em>. These layers can interpret the input images as they store some abstract representation in their parameters (called <em>weights</em>) using an operation called <em>convolution</em>. These representation are stored in layers that we call <em>feature maps</em>. Once we feed an image to a network, each pixel will contribute to the activation of certain feature map, which in turn will lead to a certain prediction. We can use these representation in a different way: to describe some properties (a.k.a. style) that we want to optimize in a picture. This optimization is possible as the activations each filter are <em>differentiable</em> with respect to the input: this means that we can tweak the input using the gradient descent (or other algorithms) in an iterative way.</p>

<p>An example of such application is called <em>neural style transfer</em>,  an optimization technique used to achieve image stylization in a non-photorealistic way. In the next sections, the basic concept of style transfer is described. Following, an extension for applying this technique on 3d models is given.</p>

<h2 id="neural-style-transfer">Neural style transfer</h2>

<p>Neural style transfer is used to take two images, a content image and a style reference image (such as an artwork by a famous painter), and blend them together so the output image looks like the content image, but ‚Äúpainted‚Äù in the style of the style reference image. Some examples of stylized images are shown below.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/style2d.png" alt="" title="example image" />
    </div>
</div>
<div class="caption">
    Example of style transfer, taken from the  <a href="https://arxiv.org/pdf/1508.06576.pdf" target="blank">original paper</a>. In the top left image, there is the content. In the three other images, the output for three different styles is shown. 
</div>

<p>The main architecture requried for style transfer is a pretrained convolutional neural network. Then, the optimization procedure is computed using three components: (i) a content image, (ii) a style image, (iii) and the input image, which is the one that is generated as final output. What allows the network to generate these beutiful stylized images is at the core of the optimization process: the loss function. Let‚Äôs discuss them in detail to understain better what‚Äôs going on.</p>

<h3 id="a-matter-of-loss">A matter of loss</h3>
<p>Neural style transfer is based on two loss functions: the <strong>content loss</strong> and the <strong>style loss</strong>. The first ensures that the activations of the higher layers of the neural network activates in the same way between the content image and the generated image. The other loss allows the correlation of the activation between the layers on the networks are similar between the style image and the generated image. Let‚Äôs break each of the functions down.</p>

<h4 id="content-loss-function">Content loss function</h4>
<p>The content loss function allows that what it‚Äôs represented in the content image to be preserved in the generated image. It does so based on the pattern of activations of the last layers of the model. The different layers of CNNS captures patterns with different levels of detail: the first layers focus more on the individual pixels, and they learn small patterns like lines or curves. Deeper layers of the network learns more abstract shapes.  Below, we can see how the different filters activate when the image of a face is fed to a CNN.</p>

<div class="row">
    <div class="col-sm-12 mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cnn_layers.jpeg" alt="" title="example image" />
    </div>
</div>
<div class="caption">
    Filters of the CNN at different level of depth learns features with different complexity: first layers learnt basic primitives (edges and colours). Deeper filters learnt textures and patterns. The final layers contains complex features, which can resemble objects from the training data. 
</div>

<p>Therefore we will use the pattern of activation of the last layer of the CNN to define this loss function. Let <em>A</em> be the activation of a layer <em>l</em>, at the <em>i</em>-th feature map and the <em>j</em>-th position. Then the content loss function, based on the generated image <em>g</em> and the content image <em>c</em>, is defined as:</p>

<p align="center">
        <img src="https://latex.codecogs.com/png.image?\dpi{150}&space;L_{content}&space;=&space;\frac{1}{2}&space;\sum_{ij}^{}&space;(A^l_{ij}&space;(g)&space;-&space;A^l_{ij}&space;(c))^2&space;&space;&space;" title="L_{content} = \frac{1}{2} \sum_{ij}^{} (A^l_{ij} (g) - A^l_{ij} (c))^2 " />
</p>

<p>In a nutshell, this function takes the <em>root mean squared error</em> between the activation produced by the two images.</p>

<h4 id="style-loss-function">Style loss function</h4>
<p>Defining the style loss function requires some extra steps than the previous loss. In order to extract the style from the CNN, we make use of all the layers available. We then define the <em>style information</em> as the amount of correlation between the features maps in a given layer. The loss is then defined as the difference in correlation between the feature maps activated by the generated image and the style image:</p>

<p align="center">
<img src="https://latex.codecogs.com/png.image?\dpi{150}&space;L_{style}&space;=&space;\sum_{l}^{}&space;w^l&space;L^l_{style}&space;\qquad&space;where&space;\\&space;&space;&space;&space;&space;&space;&space;&space;&space;&space;&space;" title="L_{style} = \sum_{l}^{} w^l L^l_{style} \qquad where \\ " />
</p>
<p align="center">
<img src="https://latex.codecogs.com/png.image?\dpi{150}&space;L^l_{style}&space;=&space;\frac{1}{M^l}&space;\sum_{ij}^{}&space;(G^l_{ij}&space;(s)&space;-&space;G^l_{ij}&space;(g))^2&space;\qquad&space;where&space;\\&space;&space;&space;&space;&space;&space;&space;&space;&space;&space;&space;" title="L^l_{style} = \frac{1}{M^l} \sum_{ij}^{} (G^l_{ij} (s) - G^l_{ij} (g))^2 \qquad where \\ " />
</p>
<p align="center">
<img src="https://latex.codecogs.com/png.image?\dpi{150}&space;G^l_{ij}&space;(I)&space;=&space;\sum_{k}^{}&space;A^l_{ik}&space;(I)A^l_{jk}&space;(I)&space;" title="G^l_{ij} (I) = \sum_{k}^{} A^l_{ik} (I)A^l_{jk} (I) " />
</p>

<p>Where <em>w</em> is a weight given to each layer during the loss computation and <em>M</em> is a hyperparameter that depends on the size of the layer <em>l</em>.</p>

<p>Even though the formulas above seems complex, the idea behind is very simple. The goal is to compute two <em>style matrices</em>, one for the style image and one for the generated image. Then, the loss is defined as the root mean square difference between the two style matrices. The style matrix (also known as Gram matrix) captures the distribution of features maps in a given layer. Minimizing the style loss between the two images, we are trying to match the distribution of features between the two images.</p>

<h4 id="final-loss">Final loss</h4>
<p>The final loss is defines as a weighted sum of the two losses defined above:</p>

<p align="center">
	<img src="https://latex.codecogs.com/png.image?\dpi{150}&space;L&space;=&space;\alpha&space;L_{content}&space;&plus;&space;\beta&space;L_{style}&space;&space;" title="L = \alpha L_{content} + \beta L_{style} " />
</p>

<p>Where <strong>Œ±</strong> and <strong>Œ≤</strong> are two hyper-parameter decided by the user. Controlling these two parameters allow to control the amount of style and content injected in the generated image. In the examples below the effect of these two parameters is shown.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/alpha_beta.png" alt="" title="example image" />
    </div>
</div>
<div class="caption">
    Example of style transfer for different values of  Œ± and Œ≤, taken from the  <a href="https://arxiv.org/pdf/1508.06576.pdf" target="blank">original paper</a>. In the left, the ratio Œ±/Œ≤ is the smallest: the generated image contains mostly the pattern of the style. As we go to the right, the ratio become bigger, and the pattern of the content image appears more clear.  
</div>

<p>Changing the parametrization of the optimization problem can change drastically the results of the neural network, despite the other components (i.e. loss function) remains the same.</p>

<h2 id="3d-neural-style-transfer">3D Neural style transfer</h2>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/style4.jpeg" alt="" title="example image" />
    </div>
</div>
<div class="caption">
    Example 2
</div>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/style5.jpeg" alt="" title="example image" />
    </div>
</div>
<div class="caption">
    Example 3
</div>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/style3.jpeg" alt="" title="example image" />
    </div>
</div>
<div class="caption">
    Example 4
</div>

  </article>

</div>

    </div>

    <!-- Footer -->


    <!--This is a comment. 
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2021 Federico  Ferlito.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank">Unsplash</a>.

    
    
  </div>
</footer>

-->

  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
